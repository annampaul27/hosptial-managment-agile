

{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reports | Front Desk - BetaCare</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'core/css/admin.css' %}">

    <style>
        .report-section {
            background: var(--white);
            border-radius: var(--radius-xl);
            padding: var(--space-6);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--gray-200);
            margin-bottom: var(--space-6);
        }

        .report-section-title {
            font-family: var(--font-heading);
            font-size: 1.05rem;
            font-weight: 700;
            color: var(--gray-800);
            margin-bottom: var(--space-5);
            display: flex;
            align-items: center;
            gap: var(--space-2);
            padding-bottom: var(--space-4);
            border-bottom: 1px solid var(--gray-100);
        }

        .doctor-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-3) 0;
            border-bottom: 1px solid var(--gray-100);
        }

        .doctor-row:last-child { border-bottom: none; }

        .doctor-info {
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }

        .doctor-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #22d3ee, #a78bfa);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        .progress-bar-wrap {
            flex: 1;
            margin: 0 var(--space-4);
            height: 8px;
            background: var(--gray-100);
            border-radius: 99px;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            border-radius: 99px;
            background: linear-gradient(90deg, #22d3ee, #a78bfa);
        }

        .method-card {
            background: var(--gray-50);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-lg);
            padding: var(--space-5);
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
        }

        .method-icon {
            width: 44px;
            height: 44px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.1rem;
            margin-bottom: var(--space-2);
        }

        .summary-stat {
            text-align: center;
            padding: var(--space-5);
        }

        .summary-stat .big-num {
            font-family: var(--font-heading);
            font-size: 2.2rem;
            font-weight: 800;
            line-height: 1;
            margin-bottom: var(--space-1);
        }

        .summary-stat .label {
            font-size: 0.85rem;
            color: var(--gray-500);
            font-weight: 500;
        }

        .divider-v {
            width: 1px;
            background: var(--gray-200);
            align-self: stretch;
        }
    </style>
</head>

<body>
    <div class="medical-dashboard">

        <!-- ==================== SIDEBAR ==================== -->
        <aside class="medical-sidebar">
            <div class="brand">
                <div class="brand-logo">
                    <svg width="40" height="40" viewBox="0 0 40 40" fill="none">
                        <circle cx="20" cy="20" r="18" fill="url(#gradient)" opacity="0.2" />
                        <path d="M20 8V32M8 20H32" stroke="url(#gradient)" stroke-width="3" stroke-linecap="round" />
                        <defs>
                            <linearGradient id="gradient" x1="0" y1="0" x2="40" y2="40">
                                <stop offset="0%" stop-color="#22d3ee" />
                                <stop offset="100%" stop-color="#a78bfa" />
                            </linearGradient>
                        </defs>
                    </svg>
                </div>
                <span class="brand-name">Beta Care</span>
            </div>

            <div class="profile-card">
                <div class="profile-avatar-wrapper">
                    <div class="profile-avatar">
                        <img src="{% static 'core/images/avatar-placeholder.jpg' %}" alt="Profile"
                            onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                        <div class="avatar-fallback" style="display: flex;">
                            {{ request.user.first_name|default:request.user.username|slice:":1"|upper }}
                        </div>
                    </div>
                </div>
                <div class="profile-details">
                    <h4 class="profile-name">{{ request.user.get_full_name|default:request.user.username }}</h4>
                    <p class="profile-email">{{ request.user.email|truncatechars:25 }}</p>
                </div>
                <span class="role-badge" style="background: linear-gradient(135deg, #f59e0b, #f97316);">Front Desk</span>
            </div>

            <nav class="sidebar-nav">
                <a href="{% url 'frontdesk_dashboard' %}" class="nav-item">
                    <i class="fa-solid fa-home"></i>
                    <span>Dashboard</span>
                </a>
                <a href="{% url 'frontdesk_book_appointment' %}" class="nav-item">
                    <i class="fa-solid fa-calendar"></i>
                    <span>Appointments</span>
                </a>
                <a href="{% url 'frontdesk_book_lab_test' %}" class="nav-item">
                    <i class="fa-solid fa-flask"></i><span>Lab Tests</span>
                </a>
                
                <a href="{% url 'frontdesk_patients_list' %}" class="nav-item">
                    <i class="fa-solid fa-users"></i>
                    <span>Patients</span>
                </a>
                <a href="{% url 'frontdesk_doctors_list' %}" class="nav-item">
                    <i class="fa-solid fa-stethoscope"></i>
                    <span>Doctors</span>
                </a>
                <a href="{% url 'frontdesk_payments' %}" class="nav-item">
                    <i class="fa-solid fa-credit-card"></i>
                    <span>Payments</span>
                </a>
                <a href="{% url 'frontdesk_reports' %}" class="nav-item active">
                    <i class="fa-solid fa-chart-bar"></i>
                    <span>Reports</span>
                </a>
                <a href="{% url 'frontdesk_settings' %}" class="nav-item">
                    <i class="fa-solid fa-gear"></i>
                    <span>Settings</span>
                </a>
            </nav>

            <div class="sidebar-footer">
                <a href="{% url 'logout' %}" class="logout-link">
                    <i class="fa-solid fa-arrow-right-from-bracket"></i>
                    <span>Logout</span>
                </a>
            </div>
        </aside>

        <!-- ==================== MAIN CONTENT ==================== -->
        <main class="medical-main">

            <header class="medical-header">
                <div class="header-left">
                    <h1 class="page-title" style="font-size:1.75rem;">Reports & Analytics</h1>
                    <p class="page-subtitle">Overview of hospital activity for the past 30 days</p>
                </div>
                <div class="header-actions">
                    <button class="header-icon-btn">
                        <i class="fa-solid fa-bell"></i>
                    </button>
                </div>
            </header>

            <div class="medical-content">

                <!-- Summary Stats -->
                <div class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); margin-bottom: var(--space-6);">

                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #22d3ee, #06b6d4);">
                            <i class="fa-solid fa-calendar-day"></i>
                        </div>
                        <div class="stat-info">
                            <p class="stat-label">Today's Appointments</p>
                            <h3 class="stat-value">{{ todays_appointments }}</h3>
                            <p class="stat-change" style="color: var(--text-medium);">
                                <i class="fa-solid fa-clock"></i> <span>Scheduled today</span>
                            </p>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #34d399, #10b981);">
                            <i class="fa-solid fa-calendar-check"></i>
                        </div>
                        <div class="stat-info">
                            <p class="stat-label">Monthly Appointments</p>
                            <h3 class="stat-value">{{ monthly_appointments }}</h3>
                            <p class="stat-change positive">
                                <i class="fa-solid fa-arrow-up"></i> <span>Last 30 days</span>
                            </p>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #a78bfa, #7c3aed);">
                            <i class="fa-solid fa-indian-rupee-sign"></i>
                        </div>
                        <div class="stat-info">
                            <p class="stat-label">Monthly Revenue</p>
                            <h3 class="stat-value">₹{{ monthly_payments }}</h3>
                            <p class="stat-change positive">
                                <i class="fa-solid fa-check-circle"></i> <span>Paid this month</span>
                            </p>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
                            <i class="fa-solid fa-user-check"></i>
                        </div>
                        <div class="stat-info">
                            <p class="stat-label">Completed Today</p>
                            <h3 class="stat-value">{{ todays_checkins }}</h3>
                            <p class="stat-change" style="color: var(--text-medium);">
                                <i class="fa-solid fa-circle-check"></i> <span>Visits done</span>
                            </p>
                        </div>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-6); margin-bottom: var(--space-6);">

                    <!-- Top Doctors by Appointments -->
                    <div class="report-section">
                        <h3 class="report-section-title">
                            <i class="fa-solid fa-stethoscope" style="color: var(--medical-cyan);"></i>
                            Top Doctors by Appointments
                        </h3>

                        {% if doctor_appointments %}
                            {% for doctor in doctor_appointments %}
                            <div class="doctor-row">
                                <div class="doctor-info">
                                    <div class="doctor-avatar">
                                        {{ doctor.user.first_name|slice:":1"|upper }}{{ doctor.user.last_name|slice:":1"|upper }}
                                    </div>
                                    <div>
                                        <p style="font-weight: 600; color: var(--gray-800); font-size: 0.9rem;">
                                            Dr. {{ doctor.user.get_full_name }}
                                        </p>
                                        <p style="font-size: 0.78rem; color: var(--gray-500);">
                                            {{ doctor.specialization|default:"General" }}
                                        </p>
                                    </div>
                                </div>
                                <div class="progress-bar-wrap">
                                    {% with max=doctor_appointments.0.appointment_count %}
                                    <div class="progress-bar-fill" style="width: {% if max > 0 %}{% widthratio doctor.appointment_count max 100 %}%{% else %}0%{% endif %};"></div>
                                    {% endwith %}
                                </div>
                                <span style="font-weight: 700; color: var(--gray-800); min-width: 32px; text-align: right;">
                                    {{ doctor.appointment_count }}
                                </span>
                            </div>
                            {% endfor %}
                        {% else %}
                            <div style="text-align: center; padding: var(--space-10);">
                                <i class="fa-solid fa-stethoscope" style="font-size: 3rem; color: var(--gray-300); margin-bottom: var(--space-3);"></i>
                                <p style="color: var(--gray-500);">No doctor data available</p>
                            </div>
                        {% endif %}
                    </div>

                    <!-- Payment by Method -->
                    <div class="report-section">
                        <h3 class="report-section-title">
                            <i class="fa-solid fa-credit-card" style="color: var(--medical-cyan);"></i>
                            Payments by Method (Last 30 Days)
                        </h3>

                        {% if payment_by_method %}
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-4);">
                                {% for method in payment_by_method %}
                                <div class="method-card">
                                    <div class="method-icon"
                                        style="background: linear-gradient(135deg,
                                            {% if method.payment_method == 'UPI' %}#22d3ee, #06b6d4
                                            {% elif method.payment_method == 'Card' %}#a78bfa, #7c3aed
                                            {% elif method.payment_method == 'Cash' %}#34d399, #10b981
                                            {% else %}#f59e0b, #d97706{% endif %});">
                                        <i class="fa-solid fa-{% if method.payment_method == 'UPI' %}mobile-alt{% elif method.payment_method == 'Card' %}credit-card{% elif method.payment_method == 'Cash' %}money-bill{% else %}building-columns{% endif %}"></i>
                                    </div>
                                    <p style="font-weight: 700; color: var(--gray-800); font-size: 1rem;">
                                        {{ method.payment_method|default:"Unknown" }}
                                    </p>
                                    <p style="font-size: 1.3rem; font-weight: 800; color: var(--gray-900); font-family: var(--font-heading);">
                                        ₹{{ method.total|default:"0" }}
                                    </p>
                                    <p style="font-size: 0.8rem; color: var(--gray-500);">
                                        {{ method.count }} transaction{{ method.count|pluralize }}
                                    </p>
                                </div>
                                {% endfor %}
                            </div>
                        {% else %}
                            <div style="text-align: center; padding: var(--space-10);">
                                <i class="fa-solid fa-receipt" style="font-size: 3rem; color: var(--gray-300); margin-bottom: var(--space-3);"></i>
                                <p style="color: var(--gray-500);">No payment data for this period</p>
                            </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Monthly Summary Banner -->
                <div class="report-section" style="background: linear-gradient(135deg, #0f172a, #1e293b); border: none;">
                    <h3 class="report-section-title" style="color: white; border-bottom-color: rgba(255,255,255,0.1);">
                        <i class="fa-solid fa-chart-line" style="color: #22d3ee;"></i>
                        30-Day Summary
                    </h3>
                    <div style="display: flex; gap: var(--space-4); flex-wrap: wrap; justify-content: space-around;">

                        <div class="summary-stat">
                            <div class="big-num" style="color: #22d3ee;">{{ monthly_appointments }}</div>
                            <div class="label" style="color: rgba(255,255,255,0.6);">Total Appointments</div>
                        </div>

                        <div class="divider-v"></div>

                        <div class="summary-stat">
                            <div class="big-num" style="color: #34d399;">₹{{ monthly_payments }}</div>
                            <div class="label" style="color: rgba(255,255,255,0.6);">Revenue Collected</div>
                        </div>

                        <div class="divider-v"></div>

                        <div class="summary-stat">
                            <div class="big-num" style="color: #a78bfa;">{{ todays_appointments }}</div>
                            <div class="label" style="color: rgba(255,255,255,0.6);">Today's Appointments</div>
                        </div>

                        <div class="divider-v"></div>

                        <div class="summary-stat">
                            <div class="big-num" style="color: #f59e0b;">{{ todays_checkins }}</div>
                            <div class="label" style="color: rgba(255,255,255,0.6);">Completed Today</div>
                        </div>

                    </div>
                </div>

            </div>
        </main>
    </div>
</body>
</html>