{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Prices | BetaCare</title>

    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">

    <!-- Main Stylesheet -->
    <link rel="stylesheet" href="{% static 'core/css/admin.css' %}">
</head>

<body>

    <div class="medical-dashboard">

        {% include 'core/dashboard/lab_dashboard_sidebar.html' %}

        <!-- ==================== MAIN CONTENT ==================== -->
        <main class="medical-main">

            <!-- Top Header -->
            <header class="medical-header">
                <div class="header-left">
                    <h1 class="page-title">Test Prices</h1>
                    <p class="page-subtitle">Manage diagnostic test pricing and availability</p>
                </div>
                <div class="header-actions">
                    <button class="header-icon-btn">
                        <i class="fa-solid fa-filter"></i>
                    </button>
                    <a href="{% url 'lab_add_test' %}"
                        style="display:inline-flex; align-items:center; gap:8px;
                                padding:0.75rem 2rem;
                                background:linear-gradient(135deg, #60a5fa, #3b82f6);
                                color:white;
                                border-radius:var(--radius-md);
                                font-weight:600;
                                text-decoration:none;">
                            <i class="fa-solid fa-plus"></i>
                            Add First Test
                    </a>

                </div>
            </header>

            <!-- Page Content -->
            <div class="medical-content">

                <!-- Summary Stats -->
                <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(200px, 1fr)); gap:var(--space-4); margin-bottom:var(--space-6);">
                    <div style="padding:var(--space-5); background:white; border-radius:var(--radius-lg); box-shadow:var(--shadow-sm); border-left:4px solid var(--medical-cyan);">
                        <p style="color:var(--gray-500); font-size:0.85rem; margin-bottom:var(--space-2);">Total Tests</p>
                        <h3 style="color:var(--gray-800); font-size:1.75rem; font-weight:700;">{{ tests.count|default:"0" }}</h3>
                    </div>
                    <div style="padding:var(--space-5); background:white; border-radius:var(--radius-lg); box-shadow:var(--shadow-sm); border-left:4px solid var(--medical-purple);">
                        <p style="color:var(--gray-500); font-size:0.85rem; margin-bottom:var(--space-2);">Active Tests</p>
                        <h3 style="color:var(--gray-800); font-size:1.75rem; font-weight:700;">{{ active_tests_count|default:"0" }}</h3>
                    </div>
                    <div style="padding:var(--space-5); background:white; border-radius:var(--radius-lg); box-shadow:var(--shadow-sm); border-left:4px solid var(--medical-blue);">
                        <p style="color:var(--gray-500); font-size:0.85rem; margin-bottom:var(--space-2);">Avg. Price</p>
                        <h3 style="color:var(--gray-800); font-size:1.75rem; font-weight:700;">₹{{ avg_price|default:"0" }}</h3>
                    </div>
                </div>

                <!-- Price List Table -->
                <div class="medical-table-card">
                    <div class="info-header" style="margin-bottom:var(--space-5);">
                        <h3><i class="fa-solid fa-tags" style="color:var(--medical-blue); margin-right:var(--space-2);"></i>Diagnostic Test Price List</h3>
                        <div style="display:flex; gap:var(--space-3); align-items:center;">
                            <input type="text" placeholder="Search tests..." style="padding:0.5rem 1rem; border:1px solid var(--gray-300); border-radius:var(--radius-md); font-size:0.9rem; width:250px;">
                            <select style="padding:0.5rem 1rem; border:1px solid var(--gray-300); border-radius:var(--radius-md); font-size:0.9rem;">
                                <option>All Categories</option>
                                <option>Blood Tests</option>
                                <option>Imaging</option>
                                <option>Screening</option>
                            </select>
                        </div>
                    </div>

                    {% if tests %}
                    <div class="table-responsive">
                        <table class="table" style="width:100%;">
                            <thead>
                                <tr>
                                    <th style="text-align:left; padding:var(--space-3) var(--space-4);">
                                        <i class="fa-solid fa-flask" style="margin-right:6px; color:var(--gray-400);"></i>Test Name
                                    </th>
                                    <th style="text-align:left; padding:var(--space-3) var(--space-4);">
                                        <i class="fa-solid fa-list" style="margin-right:6px; color:var(--gray-400);"></i>Category
                                    </th>
                                    <th style="text-align:left; padding:var(--space-3) var(--space-4);">
                                        <i class="fa-solid fa-indian-rupee-sign" style="margin-right:6px; color:var(--gray-400);"></i>Price
                                    </th>
                                    <th style="text-align:center; padding:var(--space-3) var(--space-4);">
                                        <i class="fa-solid fa-clock" style="margin-right:6px; color:var(--gray-400);"></i>Duration
                                    </th>
                                    <th style="text-align:center; padding:var(--space-3) var(--space-4);">
                                        <i class="fa-solid fa-toggle-on" style="margin-right:6px; color:var(--gray-400);"></i>Status
                                    </th>
                                    <th style="text-align:center; padding:var(--space-3) var(--space-4);">
                                        <i class="fa-solid fa-cog" style="margin-right:6px; color:var(--gray-400);"></i>Actions
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for test in tests %}
                                <tr style="border-bottom:1px solid var(--gray-100);">
                                    <td style="padding:var(--space-4);">
                                        <div style="display:flex; align-items:center; gap:var(--space-3);">
                                            <div style="width:40px; height:40px; border-radius:var(--radius-md); background:linear-gradient(135deg, #60a5fa, #3b82f6); display:flex; align-items:center; justify-content:center; color:white;">
                                                <i class="fa-solid fa-vial"></i>
                                            </div>
                                            <div>
                                                <p style="font-weight:600; color:var(--gray-800); margin-bottom:2px;">{{ test.test_name }}</p>
                                                <p style="font-size:0.8rem; color:var(--gray-500);">{{ test.description|default:"Standard lab test"|truncatechars:40 }}</p>
                                            </div>
                                        </div>
                                    </td>
                                    <td style="padding:var(--space-4);">
                                        <span style="padding:0.4rem 0.9rem; background:rgba(34,211,238,0.1); color:var(--medical-cyan); border-radius:var(--radius-full); font-size:0.85rem; font-weight:600;">
                                            {{ test.category|default:"General" }}
                                        </span>
                                    </td>
                                    <td style="padding:var(--space-4);">
                                        <div>
                                            <p style="font-weight:700; color:var(--gray-800); font-size:1.1rem;">₹{{ test.price }}</p>
                                            <p style="font-size:0.75rem; color:var(--gray-500);">Per test</p>
                                        </div>
                                    </td>
                                    <td style="padding:var(--space-4); text-align:center;">
                                        <p style="color:var(--gray-700);">{{ test.result_duration|default:"24 hrs" }}</p>
                                    </td>
                                    <td style="padding:var(--space-4); text-align:center;">
                                        <label style="position:relative; display:inline-block; width:50px; height:26px;">
                                            <input type="checkbox"
                                                {% if test.is_active %}checked{% endif %}
                                                style="opacity:0; width:0; height:0;">

                                            <span style="position:absolute; cursor:pointer; top:0; left:0; right:0; bottom:0; background:linear-gradient(135deg, #34d399, #10b981); border-radius:26px; transition:0.3s;"></span>
                                            <span style="position:absolute; content:''; height:20px; width:20px; left:3px; bottom:3px; background:white; border-radius:50%; transition:0.3s;"></span>
                                        </label>
                                    </td>
                                    <td style="padding:var(--space-4); text-align:center;">
                                        <div style="display:flex; gap:var(--space-2); justify-content:center;">
                                            <a href="{% url 'lab_edit_test' test.id %}"
                                            style="padding:0.5rem 1rem;
                                                    background:rgba(60,140,250,0.1);
                                                    color:var(--medical-blue);
                                                    border-radius:var(--radius-md);
                                                    font-size:0.85rem;
                                                    font-weight:600;
                                                    text-decoration:none;
                                                    display:inline-flex;
                                                    align-items:center;
                                                    gap:6px;
                                                    transition:var(--transition);"
                                            onmouseover="this.style.background='var(--medical-blue)'; this.style.color='white';"
                                            onmouseout="this.style.background='rgba(96,165,250,0.1)'; this.style.color='var(--medical-blue)';">
                                                <i class="fa-solid fa-edit"></i> Edit
                                            </a>
                                            
                                            <form method="POST"
                                                action="{% url 'lab_delete_test' test.id %}"
                                                style="display:inline;">
                                                {% csrf_token %}
                                                <button type="submit"
                                                    onclick="return confirm('Are you sure you want to delete this test?');"
                                                    style="padding:0.5rem 1rem;
                                                        background:rgba(239,68,68,0.1);
                                                        color:#dc2626;
                                                        border:none;
                                                        border-radius:var(--radius-md);
                                                        font-size:0.85rem;
                                                        font-weight:600;
                                                        cursor:pointer;
                                                        transition:var(--transition);"
                                                    onmouseover="this.style.background='#dc2626'; this.style.color='white';"
                                                    onmouseout="this.style.background='rgba(239,68,68,0.1)'; this.style.color='#dc2626';">
                                                    <i class="fa-solid fa-trash"></i>
                                                </button>
                                            </form>

                                            
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <div style="text-align:center; padding:var(--space-8) var(--space-4);">
                        <i class="fa-solid fa-tags" style="font-size:4rem; color:var(--gray-300); margin-bottom:var(--space-4);"></i>
                        <h3 style="color:var(--gray-600); margin-bottom:var(--space-2);">No tests configured</h3>
                        <p style="color:var(--gray-500); margin-bottom:var(--space-4);">Add your first diagnostic test to get started.</p>
                        <a href="{% url 'lab_add_test' %}"
                        style="display:inline-flex; align-items:center; gap:8px;
                                padding:0.75rem 2rem;
                                background:linear-gradient(135deg, #60a5fa, #3b82f6);
                                color:white;
                                border-radius:var(--radius-md);
                                font-weight:600;
                                text-decoration:none;">
                            <i class="fa-solid fa-plus"></i>
                            Add First Test
                        </a>

                    </div>
                    {% endif %}
                </div>

                <!-- Popular Tests Section -->
                <div class="medical-table-card" style="margin-top:var(--space-6);">
                    <div class="info-header" style="margin-bottom:var(--space-5);">
                        <h3><i class="fa-solid fa-star" style="color:var(--medical-cyan); margin-right:var(--space-2);"></i>Most Requested Tests</h3>
                    </div>
                    <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(280px, 1fr)); gap:var(--space-4);">
                        
                        <div style="padding:var(--space-5); background:linear-gradient(135deg, rgba(34,211,238,0.05), rgba(6,182,212,0.05)); border-radius:var(--radius-lg); border:1px solid var(--gray-200);">
                            <div style="display:flex; align-items:center; gap:var(--space-3); margin-bottom:var(--space-3);">
                                <div style="width:48px; height:48px; border-radius:var(--radius-md); background:linear-gradient(135deg, #22d3ee, #06b6d4); display:flex; align-items:center; justify-content:center; color:white;">
                                    <i class="fa-solid fa-heartbeat"></i>
                                </div>
                                <div>
                                    <h4 style="color:var(--gray-800); font-weight:600; margin-bottom:2px;">Complete Blood Count</h4>
                                    <p style="font-size:0.8rem; color:var(--gray-500);">CBC Test</p>
                                </div>
                            </div>
                            <div style="display:flex; justify-content:space-between; align-items:center;">
                                <span style="font-weight:700; color:var(--gray-800); font-size:1.25rem;">₹350</span>
                                <span style="padding:0.4rem 0.9rem; background:rgba(34,211,238,0.2); color:var(--medical-cyan); border-radius:var(--radius-full); font-size:0.8rem; font-weight:600;">
                                    <i class="fa-solid fa-fire"></i> Popular
                                </span>
                            </div>
                        </div>

                        <div style="padding:var(--space-5); background:linear-gradient(135deg, rgba(167,139,250,0.05), rgba(139,92,246,0.05)); border-radius:var(--radius-lg); border:1px solid var(--gray-200);">
                            <div style="display:flex; align-items:center; gap:var(--space-3); margin-bottom:var(--space-3);">
                                <div style="width:48px; height:48px; border-radius:var(--radius-md); background:linear-gradient(135deg, #a78bfa, #8b5cf6); display:flex; align-items:center; justify-content:center; color:white;">
                                    <i class="fa-solid fa-dna"></i>
                                </div>
                                <div>
                                    <h4 style="color:var(--gray-800); font-weight:600; margin-bottom:2px;">Lipid Profile</h4>
                                    <p style="font-size:0.8rem; color:var(--gray-500);">Cholesterol Test</p>
                                </div>
                            </div>
                            <div style="display:flex; justify-content:space-between; align-items:center;">
                                <span style="font-weight:700; color:var(--gray-800); font-size:1.25rem;">₹550</span>
                                <span style="padding:0.4rem 0.9rem; background:rgba(167,139,250,0.2); color:var(--medical-purple); border-radius:var(--radius-full); font-size:0.8rem; font-weight:600;">
                                    <i class="fa-solid fa-fire"></i> Popular
                                </span>
                            </div>
                        </div>

                        <div style="padding:var(--space-5); background:linear-gradient(135deg, rgba(96,165,250,0.05), rgba(59,130,246,0.05)); border-radius:var(--radius-lg); border:1px solid var(--gray-200);">
                            <div style="display:flex; align-items:center; gap:var(--space-3); margin-bottom:var(--space-3);">
                                <div style="width:48px; height:48px; border-radius:var(--radius-md); background:linear-gradient(135deg, #60a5fa, #3b82f6); display:flex; align-items:center; justify-content:center; color:white;">
                                    <i class="fa-solid fa-vials"></i>
                                </div>
                                <div>
                                    <h4 style="color:var(--gray-800); font-weight:600; margin-bottom:2px;">Thyroid Function</h4>
                                    <p style="font-size:0.8rem; color:var(--gray-500);">T3, T4, TSH</p>
                                </div>
                            </div>
                            <div style="display:flex; justify-content:space-between; align-items:center;">
                                <span style="font-weight:700; color:var(--gray-800); font-size:1.25rem;">₹450</span>
                                <span style="padding:0.4rem 0.9rem; background:rgba(96,165,250,0.2); color:var(--medical-blue); border-radius:var(--radius-full); font-size:0.8rem; font-weight:600;">
                                    <i class="fa-solid fa-fire"></i> Popular
                                </span>
                            </div>
                        </div>

                    </div>
                </div>

            </div>
        </main>
    </div>

</body>
</html>