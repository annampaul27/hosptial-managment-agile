{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment Details | BetaCare</title>

    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">

    <!-- Main Stylesheet -->
    <link rel="stylesheet" href="{% static 'core/css/admin.css' %}">

    <style>
        .payment-status-badge {
            display: inline-block;
            padding: 0.5rem 1rem;
            border-radius: var(--radius-full);
            font-size: 0.875rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-paid {
            background: rgba(34, 197, 94, 0.1);
            color: #16a34a;
        }

        .status-pending {
            background: rgba(245, 158, 11, 0.1);
            color: #d97706;
        }

        .status-failed {
            background: rgba(239, 68, 68, 0.1);
            color: #dc2626;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: var(--space-4) 0;
            border-bottom: 1px solid var(--gray-200);
        }

        .detail-row:last-child {
            border-bottom: none;
        }

        .detail-label {
            color: var(--gray-600);
            font-weight: 500;
        }

        .detail-value {
            color: var(--gray-900);
            font-weight: 600;
            text-align: right;
        }

        .amount-display {
            font-size: 2rem;
            font-weight: 700;
            color: var(--medical-cyan);
            text-align: center;
            margin: var(--space-6) 0;
        }

        .print-btn {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
            padding: var(--space-3) var(--space-6);
            border-radius: var(--radius-md);
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: var(--space-2);
        }

        .print-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
    </style>
</head>

<body>

    <div class="medical-dashboard">

        <!-- ==================== SIDEBAR ==================== -->
        <aside class="medical-sidebar">
            <!-- Brand -->
            <div class="brand">
                <div class="brand-logo">
                    <svg width="40" height="40" viewBox="0 0 40 40" fill="none">
                        <circle cx="20" cy="20" r="18" fill="url(#gradient)" opacity="0.2" />
                        <path d="M20 8V32M8 20H32" stroke="url(#gradient)" stroke-width="3" stroke-linecap="round" />
                        <defs>
                            <linearGradient id="gradient" x1="0" y1="0" x2="40" y2="40">
                                <stop offset="0%" stop-color="#22d3ee" />
                                <stop offset="100%" stop-color="#a78bfa" />
                            </linearGradient>
                        </defs>
                    </svg>
                </div>
                <span class="brand-name">Beta Care</span>
            </div>

            <!-- Profile Card -->
            <div class="profile-card">
                <div class="profile-avatar-wrapper">
                    <div class="profile-avatar">
                        <img src="{% static 'core/images/avatar-placeholder.jpg' %}" alt="Profile"
                            onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                        <div class="avatar-fallback" style="display: flex;">
                            {{ request.user.first_name|default:request.user.username|slice:":1"|upper }}
                        </div>
                    </div>
                </div>
                <div class="profile-details">
                    <h4 class="profile-name">{{ request.user.get_full_name|default:request.user.username }}</h4>
                    <p class="profile-email">{{ request.user.email|truncatechars:25 }}</p>
                </div>
                <span class="role-badge" style="background: linear-gradient(135deg, #34d399, #10b981);">Patient</span>
            </div>

            <!-- Navigation Menu -->
            <nav class="sidebar-nav">
                <a href="{% url 'patient_dashboard' %}" class="nav-item">
                    <i class="fa-solid fa-home"></i>
                    <span>Dashboard</span>
                </a>
                <a href="{% url 'patient_book_appointment' %}" class="nav-item">
                    <i class="fa-solid fa-calendar-plus"></i>
                    <span>Book Appointment</span>
                </a>
                <a href="{% url 'patient_appointments' %}" class="nav-item">
                    <i class="fa-solid fa-clock"></i>
                    <span>My Appointments</span>
                </a>
                <a href="{% url 'patient_diagnostic_tests' %}" class="nav-item">
                    <i class="fa-solid fa-flask"></i>
                    <span>Diagnostic Tests</span>
                </a>
                <a href="{% url 'patient_lab_results' %}" class="nav-item active">
                    <i class="fa-solid fa-file-medical"></i>
                    <span>Lab Results</span>
                </a>
                <a href="{% url 'patient_prescriptions' %}" class="nav-item">
                    <i class="fa-solid fa-prescription"></i>
                    <span>Prescriptions</span>
                </a>
                
                <a href="{% url 'payments' %}" class="nav-item active">
                    <i class="fa-solid fa-credit-card"></i>
                    <span>Payments</span>
                </a>
                <a href="{% url 'patient_settings' %}" class="nav-item active">
                    <i class="fa-solid fa-gear"></i>
                    <span>Settings</span>
                </a>
            </nav>

            <!-- Logout Button -->
            <div class="sidebar-footer">
                <a href="{% url 'logout' %}" class="logout-link">
                    <i class="fa-solid fa-arrow-right-from-bracket"></i>
                    <span>Logout</span>
                </a>
            </div>
        </aside>

        <!-- ==================== MAIN CONTENT ==================== -->
        <main class="medical-main">

            <!-- Top Header -->
            <header class="medical-header">
                <div class="header-left">
                    <h1 class="page-title" style="font-size:1.75rem;">Payment Details</h1>
                    <p class="page-subtitle">Transaction information and receipt</p>
                </div>
                <div class="header-actions">
                    <a href="{% url 'payments' %}" class="btn-cancel" style="text-decoration:none;">
                        <i class="fa-solid fa-arrow-left"></i> Back to Payments
                    </a>
                </div>
            </header>

            <!-- Page Content -->
            <div class="medical-content">

                <div style="max-width: 800px; margin: 0 auto;">

                    <!-- Payment Status Card -->
                    <div class="medical-table-card" style="margin-bottom: var(--space-6); text-align: center;">
                        <div style="padding: var(--space-6);">
                            {% if payment.payment_status == 'Paid' %}
                                <i class="fa-solid fa-check-circle" style="font-size: 4rem; color: #16a34a; margin-bottom: var(--space-4);"></i>
                                <h2 style="color: #16a34a; margin-bottom: var(--space-2);">Payment Successful</h2>
                            {% elif payment.payment_status == 'Pending' %}
                                <i class="fa-solid fa-clock" style="font-size: 4rem; color: #d97706; margin-bottom: var(--space-4);"></i>
                                <h2 style="color: #d97706; margin-bottom: var(--space-2);">Payment Pending</h2>
                            {% else %}
                                <i class="fa-solid fa-times-circle" style="font-size: 4rem; color: #dc2626; margin-bottom: var(--space-4);"></i>
                                <h2 style="color: #dc2626; margin-bottom: var(--space-2);">Payment Failed</h2>
                            {% endif %}
                            
                            <div class="amount-display">₹{{ payment.amount }}</div>
                            
                            <span class="payment-status-badge status-{{ payment.payment_status|lower }}">
                                {{ payment.payment_status }}
                            </span>
                        </div>
                    </div>

                    <!-- Payment Details Card -->
                    <div class="medical-table-card" style="margin-bottom: var(--space-6);">
                        <div class="info-header" style="margin-bottom: var(--space-5); padding-bottom: var(--space-4); border-bottom: 1px solid var(--gray-200);">
                            <h3><i class="fa-solid fa-file-invoice" style="color: var(--medical-cyan); margin-right: var(--space-2);"></i>Payment Information</h3>
                        </div>

                        <div style="padding: 0 var(--space-4);">
                            <div class="detail-row">
                                <span class="detail-label">Payment ID</span>
                                <span class="detail-value">#{{ payment.id }}</span>
                            </div>

                            {% if payment.transaction_id %}
                            <div class="detail-row">
                                <span class="detail-label">Transaction ID</span>
                                <span class="detail-value">{{ payment.transaction_id }}</span>
                            </div>
                            {% endif %}

                            <div class="detail-row">
                                <span class="detail-label">Amount</span>
                                <span class="detail-value" style="color: var(--medical-cyan); font-size: 1.25rem;">₹{{ payment.amount }}</span>
                            </div>

                            <div class="detail-row">
                                <span class="detail-label">Payment Method</span>
                                <span class="detail-value">
                                    {% if payment.payment_method %}
                                        {{ payment.payment_method }}
                                    {% else %}
                                        Not specified
                                    {% endif %}
                                </span>
                            </div>

                            <div class="detail-row">
                                <span class="detail-label">Payment Date</span>
                                <span class="detail-value">{{ payment.payment_date|date:"F d, Y, g:i A" }}</span>
                            </div>

                            <div class="detail-row">
                                <span class="detail-label">Status</span>
                                <span class="detail-value">
                                    <span class="payment-status-badge status-{{ payment.payment_status|lower }}" style="font-size: 0.75rem;">
                                        {{ payment.payment_status }}
                                    </span>
                                </span>
                            </div>
                        </div>
                    </div>

                    <!-- Appointment Details Card -->
                    {% if payment.appointment %}
                    <div class="medical-table-card" style="margin-bottom: var(--space-6);">
                        <div class="info-header" style="margin-bottom: var(--space-5); padding-bottom: var(--space-4); border-bottom: 1px solid var(--gray-200);">
                            <h3><i class="fa-solid fa-calendar-check" style="color: var(--medical-purple); margin-right: var(--space-2);"></i>Appointment Details</h3>
                        </div>

                        <div style="padding: 0 var(--space-4);">
                            <div class="detail-row">
                                <span class="detail-label">Doctor</span>
                                <span class="detail-value">Dr. {{ payment.appointment.doctor.user.get_full_name }}</span>
                            </div>

                            <div class="detail-row">
                                <span class="detail-label">Specialization</span>
                                <span class="detail-value">{{ payment.appointment.doctor.specialization }}</span>
                            </div>

                            <div class="detail-row">
                                <span class="detail-label">Department</span>
                                <span class="detail-value">{{ payment.appointment.doctor.department }}</span>
                            </div>

                            <div class="detail-row">
                                <span class="detail-label">Appointment Date</span>
                                <span class="detail-value">{{ payment.appointment.appointment_date|date:"F d, Y" }}</span>
                            </div>

                            <div class="detail-row">
                                <span class="detail-label">Appointment Time</span>
                                <span class="detail-value">{{ payment.appointment.appointment_time|time:"g:i A" }}</span>
                            </div>

                            <div class="detail-row">
                                <span class="detail-label">Appointment Status</span>
                                <span class="detail-value">{{ payment.appointment.status }}</span>
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    <!-- Action Buttons -->
                    <div style="display: flex; justify-content: center; gap: var(--space-4); margin-top: var(--space-6);">
                        {% if payment.payment_status == 'Pending' %}
                        <a href="{% url 'process_payment' payment.id %}" class="add-btn" style="text-decoration: none;">
                            <i class="fa-solid fa-credit-card"></i> Complete Payment
                        </a>
                        {% endif %}

                        {% if payment.payment_status == 'Paid' %}
                        <button onclick="window.print()" class="print-btn">
                            <i class="fa-solid fa-print"></i> Print Receipt
                        </button>
                        {% endif %}

                        <a href="{% url 'payments' %}" class="btn-cancel" style="text-decoration: none; padding: var(--space-3) var(--space-6);">
                            <i class="fa-solid fa-list"></i> View All Payments
                        </a>
                    </div>

                </div>

            </div>
        </main>
    </div>

    <style media="print">
        .medical-sidebar,
        .medical-header,
        .print-btn,
        .btn-cancel,
        .add-btn {
            display: none !important;
        }

        .medical-main {
            margin: 0 !important;
            padding: 20px !important;
        }

        .medical-table-card {
            box-shadow: none !important;
            border: 1px solid #e5e7eb !important;
        }
    </style>

</body>
</html>