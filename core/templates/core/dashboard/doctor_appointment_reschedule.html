{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reschedule Appointment | BetaCare</title>

    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">

    <!-- Main Stylesheet -->
    <link rel="stylesheet" href="{% static 'core/css/admin.css' %}">
</head>

<body>
<div class="medical-dashboard">
    <!-- Sidebar -->
    <aside class="medical-sidebar">
        <div class="brand">
            <div class="brand-logo">
                <svg width="40" height="40" viewBox="0 0 40 40" fill="none">
                    <circle cx="20" cy="20" r="18" fill="url(#gradient)" opacity="0.2" />
                    <path d="M20 8V32M8 20H32" stroke="url(#gradient)" stroke-width="3" stroke-linecap="round" />
                    <defs>
                        <linearGradient id="gradient" x1="0" y1="0" x2="40" y2="40">
                            <stop offset="0%" stop-color="#22d3ee" />
                            <stop offset="100%" stop-color="#a78bfa" />
                        </linearGradient>
                    </defs>
                </svg>
            </div>
            <span class="brand-name">BetaCare</span>
        </div>

        <!-- Profile Card -->
        <div class="profile-card">
            <div class="profile-avatar-wrapper">
                <div class="profile-avatar">
                    <div class="avatar-fallback">{{ request.user.first_name|default:request.user.username|slice:":1"|upper }}</div>
                </div>
            </div>
            <div class="profile-details">
                <h4 class="profile-name">{{ request.user.get_full_name|default:request.user.username }}</h4>
                <p class="profile-email">{{ request.user.email|truncatechars:25 }}</p>
            </div>
            <span class="role-badge" style="background: linear-gradient(135deg, #22d3ee, #06b6d4);">Doctor</span>
        </div>

        <!-- Navigation Menu -->
        <nav class="sidebar-nav">
            <a href="{% url 'doctor_dashboard' %}" class="nav-item">
                <i class="fa-solid fa-chart-line"></i>
                <span>Dashboard</span>
            </a>
            <a href="{% url 'doctor_appointments' %}" class="nav-item active">
                <i class="fa-solid fa-calendar"></i>
                <span>Appointments</span>
            </a>
            <a href="{% url 'doctor_patients' %}" class="nav-item">
                <i class="fa-solid fa-users"></i>
                <span>Patient Records</span>
            </a>
            <a href="{% url 'doctor_prescriptions' %}" class="nav-item">
                <i class="fa-solid fa-prescription-bottle"></i>
                <span>Prescriptions</span>
            </a>
            <a href="{% url 'doctor_schedule' %}" class="nav-item">
                <i class="fa-solid fa-clock"></i>
                <span>Schedule</span>
            </a>
        </nav>

        <!-- Logout -->
        <div class="sidebar-footer">
            <form method="POST" action="{% url 'logout' %}" style="width: 100%;">
                {% csrf_token %}
                <button type="submit" class="logout-link" style="width: 100%; text-align: left; background: none; border: none; cursor: pointer;">
                    <i class="fa-solid fa-arrow-right-from-bracket"></i>
                    <span>Logout</span>
                </button>
            </form>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="medical-main">
        <!-- Header -->
        <header class="medical-header">
            <div class="header-left">
                <h1 class="page-title">Reschedule Appointment</h1>
                <p class="page-subtitle">Change appointment date and time</p>
            </div>
            <div class="header-actions">
                <a href="{% url 'doctor_appointment_detail' appointment.id %}" class="btn btn-secondary" style="text-decoration: none;">
                    <i class="fa-solid fa-arrow-left"></i> Back
                </a>
            </div>
        </header>

        <!-- Content -->
        <div class="medical-content">
            <div class="info-grid" style="grid-template-columns: 1.5fr 1fr;">
                <!-- Reschedule Form -->
                <div class="info-card">
                    <div class="info-header" style="margin-bottom: var(--space-6);">
                        <h3>
                            <i class="fa-solid fa-calendar-alt" style="color: var(--medical-cyan); margin-right: var(--space-2);"></i>
                            Select New Date & Time
                        </h3>
                    </div>

                    <form method="POST" action="{% url 'doctor_reschedule_appointment' appointment.id %}">
                        {% csrf_token %}
                        
                        <!-- Current Appointment Info -->
                        <div style="background: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.3); border-radius: var(--radius-lg); padding: var(--space-4); margin-bottom: var(--space-6);">
                            <p style="font-size: 0.9rem; color: var(--text-dark); margin-bottom: 8px;">
                                <strong>Current Appointment:</strong>
                            </p>
                            <p style="color: var(--text-medium);">
                                <i class="fa-solid fa-calendar"></i> {{ appointment.appointment_date|date:"l, F d, Y" }} at {{ appointment.appointment_time|time:"g:i A" }}
                            </p>
                        </div>

                        <!-- New Date Field -->
                        <div style="margin-bottom: var(--space-5);">
                            <label style="display: block; font-weight: 600; color: var(--text-dark); margin-bottom: var(--space-2); font-size: 0.95rem;">
                                <i class="fa-solid fa-calendar" style="color: var(--medical-cyan); margin-right: 6px;"></i>
                                New Appointment Date
                            </label>
                            <input type="date" 
                                   name="appointment_date" 
                                   id="appointment_date"
                                   value="{{ appointment.appointment_date|date:'Y-m-d' }}"
                                   min="{{ today|date:'Y-m-d' }}"
                                   required
                                   style="width: 100%; padding: 12px 16px; border: 2px solid var(--border-color); border-radius: var(--radius-md); font-size: 1rem; font-family: var(--font-sans); transition: var(--transition-fast);"
                                   onfocus="this.style.borderColor='var(--medical-cyan)'"
                                   onblur="this.style.borderColor='var(--border-color)'">
                        </div>

                        <!-- New Time Field -->
                        <div style="margin-bottom: var(--space-5);">
                            <label style="display: block; font-weight: 600; color: var(--text-dark); margin-bottom: var(--space-2); font-size: 0.95rem;">
                                <i class="fa-solid fa-clock" style="color: var(--medical-purple); margin-right: 6px;"></i>
                                New Appointment Time
                            </label>
                            <input type="time" 
                                   name="appointment_time" 
                                   id="appointment_time"
                                   value="{{ appointment.appointment_time|time:'H:i' }}"
                                   required
                                   style="width: 100%; padding: 12px 16px; border: 2px solid var(--border-color); border-radius: var(--radius-md); font-size: 1rem; font-family: var(--font-sans); transition: var(--transition-fast);"
                                   onfocus="this.style.borderColor='var(--medical-purple)'"
                                   onblur="this.style.borderColor='var(--border-color)'">
                            <p style="font-size: 0.85rem; color: var(--text-medium); margin-top: 8px;">
                                <i class="fa-solid fa-info-circle"></i> Working hours: 9:00 AM - 5:00 PM
                            </p>
                        </div>

                        <!-- Reason for Reschedule -->
                        <div style="margin-bottom: var(--space-6);">
                            <label style="display: block; font-weight: 600; color: var(--text-dark); margin-bottom: var(--space-2); font-size: 0.95rem;">
                                <i class="fa-solid fa-comment" style="color: var(--medical-green); margin-right: 6px;"></i>
                                Reason for Rescheduling (Optional)
                            </label>
                            <textarea name="reschedule_reason" 
                                      id="reschedule_reason"
                                      rows="4"
                                      placeholder="e.g., Doctor's schedule conflict, emergency case, etc."
                                      style="width: 100%; padding: 12px 16px; border: 2px solid var(--border-color); border-radius: var(--radius-md); font-size: 0.95rem; font-family: var(--font-sans); resize: vertical; transition: var(--transition-fast);"
                                      onfocus="this.style.borderColor='var(--medical-green)'"
                                      onblur="this.style.borderColor='var(--border-color)'"></textarea>
                        </div>

                        <!-- Notify Patient -->
                        <div style="margin-bottom: var(--space-6); padding: var(--space-4); background: var(--gray-50); border-radius: var(--radius-md);">
                            <label style="display: flex; align-items: center; gap: var(--space-3); cursor: pointer;">
                                <input type="checkbox" 
                                       name="notify_patient" 
                                       id="notify_patient"
                                       checked
                                       style="width: 20px; height: 20px; cursor: pointer;">
                                <span style="font-weight: 500; color: var(--text-dark);">
                                    <i class="fa-solid fa-envelope" style="color: var(--medical-cyan); margin-right: 6px;"></i>
                                    Notify patient via email about the rescheduled appointment
                                </span>
                            </label>
                        </div>

                        <!-- Action Buttons -->
                        <div style="display: flex; gap: var(--space-3); padding-top: var(--space-5); border-top: 1px solid var(--border-color);">
                            <button type="submit"
                                        style="flex: 1;
                                        display: inline-flex;
                                        align-items: center;
                                        justify-content: center;
                                        gap: 8px;
                                        padding: 12px 24px;
                                        background: var(--primary-blue);
                                        color: white;
                                        border: 1px solid var(--primary-blue);
                                        border-radius: var(--radius-md);
                                        font-weight: 600;
                                        font-size: 0.9rem;
                                        cursor: pointer;
                                        transition: var(--transition-fast);
                                        font-family: var(--font-sans);"
                                    onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 16px rgba(0,0,0,0.15)';"
                                    onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none';">
                                <i class="fa-solid fa-check"></i> Confirm Reschedule
                            </button>

                            <a href="{% url 'doctor_appointment_detail' appointment.id %}" 
                               class="btn btn-secondary" 
                               style="text-decoration: none; justify-content: center;">
                                <i class="fa-solid fa-times"></i> Cancel
                            </a>
                        </div>
                    </form>
                </div>

                <!-- Patient Information Sidebar -->
                <div class="info-card">
                    <div class="info-header" style="margin-bottom: var(--space-5);">
                        <h3>
                            <i class="fa-solid fa-user" style="color: var(--medical-purple); margin-right: var(--space-2);"></i>
                            Patient Information
                        </h3>
                    </div>

                    <!-- Patient Avatar & Name -->
                    <div style="text-align: center; margin-bottom: var(--space-5);">
                        <div style="width: 80px; height: 80px; margin: 0 auto var(--space-3); border-radius: 50%; background: linear-gradient(135deg, #22d3ee, #a78bfa); display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 2rem; box-shadow: var(--shadow-md);">
                            {{ appointment.patient.full_name|slice:":1"|upper }}
                        </div>
                        <h4 style="font-family: var(--font-display); font-size: 1.25rem; font-weight: 600; color: var(--text-dark); margin-bottom: 4px;">
                            {{ appointment.patient.full_name }}
                        </h4>
                        <p style="font-size: 0.9rem; color: var(--text-medium);">Patient ID: #{{ appointment.patient.id }}</p>
                    </div>

                    <!-- Contact Info -->
                    <div style="display: grid; gap: var(--space-3); margin-bottom: var(--space-5);">
                        <div style="padding: var(--space-3); background: var(--gray-50); border-radius: var(--radius-md);">
                            <p style="font-size: 0.8rem; color: var(--text-medium); margin-bottom: 4px;">
                                <i class="fa-solid fa-envelope"></i> Email
                            </p>
                            <p style="font-weight: 500; color: var(--text-dark); font-size: 0.9rem; word-break: break-word;">{{ appointment.patient.email }}</p>
                        </div>

                        <div style="padding: var(--space-3); background: var(--gray-50); border-radius: var(--radius-md);">
                            <p style="font-size: 0.8rem; color: var(--text-medium); margin-bottom: 4px;">
                                <i class="fa-solid fa-phone"></i> Phone
                            </p>
                            <p style="font-weight: 500; color: var(--text-dark); font-size: 0.9rem;">{{ appointment.patient.phone|default:"Not provided" }}</p>
                        </div>
                    </div>

                    <!-- Current Appointment Details -->
                    <div style="padding: var(--space-4); background: var(--gray-50); border-radius: var(--radius-md); border-left: 4px solid var(--medical-cyan);">
                        <p style="font-size: 0.85rem; font-weight: 600; color: var(--text-dark); margin-bottom: var(--space-3);">
                            Current Appointment Details
                        </p>
                        <div style="display: grid; gap: var(--space-2);">
                            <p style="font-size: 0.85rem; color: var(--text-medium);">
                                <strong>Reason:</strong> {{ appointment.reason }}
                            </p>
                            <p style="font-size: 0.85rem; color: var(--text-medium);">
                                <strong>Status:</strong> 
                                <span style="color: {% if appointment.status == 'Confirmed' %}#10b981{% else %}#f59e0b{% endif %};">
                                    {{ appointment.status }}
                                </span>
                            </p>
                            <p style="font-size: 0.85rem; color: var(--text-medium);">
                                <strong>Booked:</strong> {{ appointment.created_at|date:"M d, Y" }}
                            </p>
                        </div>
                    </div>

                    <!-- Important Note -->
                    <div style="margin-top: var(--space-5); padding: var(--space-4); background: rgba(59, 130, 246, 0.1); border-radius: var(--radius-md); border: 1px solid rgba(59, 130, 246, 0.2);">
                        <p style="font-size: 0.85rem; color: var(--text-dark); line-height: 1.6;">
                            <i class="fa-solid fa-info-circle" style="color: var(--medical-blue);"></i>
                            <strong>Note:</strong> The patient will be automatically notified about the new appointment time via email if the notification option is checked.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>

<script>
// Set minimum date to today
document.addEventListener('DOMContentLoaded', function() {
    const dateInput = document.getElementById('appointment_date');
    const today = new Date().toISOString().split('T')[0];
    dateInput.setAttribute('min', today);
    
    // Validate time is within working hours
    const timeInput = document.getElementById('appointment_time');
    timeInput.addEventListener('change', function() {
        const time = this.value;
        const [hours, minutes] = time.split(':').map(Number);
        
        if (hours < 9 || hours >= 17) {
            alert('Please select a time between 9:00 AM and 5:00 PM');
            this.value = '09:00';
        }
    });
});
</script>

</body>
</html>